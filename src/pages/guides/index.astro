---
import { getCollection } from "astro:content";
import "../../styles/global.css";

export const prerender = true;

const entries = await getCollection("guides");
const guides = entries
  .filter(g => !g.data.exclude)
  .sort((a, b) => {
    const aFeat = a.data.tags?.includes("featured");
    const bFeat = b.data.tags?.includes("featured");
    if (aFeat && !bFeat) return -1;
    if (!aFeat && bFeat) return 1;
    // fall back to updated desc, then title
    const aDate = a.data.updated ?? "1970-01-01";
    const bDate = b.data.updated ?? "1970-01-01";
    if (aDate !== bDate) return bDate.localeCompare(aDate);
    return a.data.title.localeCompare(b.data.title);
  });
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Guides — Tesla Arcade at Home</title>
    <meta name="description" content="How-tos and buyer’s guides to recreate Tesla Arcade at home." />
    <link rel="icon" href="/favicon.svg" />
  </head>
  <body class="mx-auto max-w-6xl px-6 py-12">
    <a class="underline text-sm" href="/">← Home</a>
    <h1 class="text-3xl font-bold mt-2 mb-3">Guides</h1>
    <p class="text-slate-600 mb-6">How-tos, upgrade paths, and buyer advice.</p>

    <ul class="grid gap-5 sm:grid-cols-2 lg:grid-cols-3">
      {guides.map(g => (
        <li class="border rounded-xl overflow-hidden hover:shadow-sm transition">
          <a href={`/guides/${g.slug}`} class="block">
            {g.data.coverImage
              ? <img src={g.data.coverImage} alt="" class="w-full aspect-[16/9] object-cover" loading="lazy" />
              : <div class="w-full aspect-[16/9] bg-slate-100 grid place-items-center text-slate-400 text-sm">No image</div>}
            <div class="p-3">
              <h2 class="font-semibold">{g.data.title}</h2>
              {g.data.short && <p class="text-sm text-slate-600 mt-1 line-clamp-2">{g.data.short}</p>}
              {g.data.tags?.length > 0 && (
                <p class="text-xs text-slate-500 mt-2">{g.data.tags.join(" · ")}</p>
              )}
            </div>
          </a>
        </li>
      ))}
    </ul>
  </body>
</html>
