---
import { getCollection } from "astro:content";
import "../../styles/global.css";

export const prerender = true;

// Load all games from the content collection
const entries = await getCollection("games");

// Sort alphabetically
const games = entries.sort((a, b) =>
  a.data.title.localeCompare(b.data.title)
);

const title = "All Games";
const description =
  "Browse every Tesla Arcade title we cover, with guides to replicate them at home.";
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{title} — Tesla Arcade at Home</title>
    <meta name="description" content={description} />
    <link rel="icon" href="/favicon.svg" />
  </head>
  <body class="mx-auto max-w-4xl px-6 py-12">
    <a class="underline text-sm" href="/">← Back home</a>

    <h1 class="text-3xl font-bold mt-2 mb-3">{title}</h1>
    <p class="text-slate-600 mb-6">{description}</p>

    <ul class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
      {games.map((g) => (
        <li class="border rounded-xl p-4 hover:shadow-sm transition">
          <a class="block" href={`/games/${g.slug}`}>
            {g.data.coverImage
              ? (
                <img
                  src={g.data.coverImage}
                  alt={`${g.data.title} cover`}
                  class="rounded-lg mb-3 aspect-[16/9] object-cover"
                  loading="lazy"
                />
              )
              : (
                <div class="mb-3 bg-slate-100 aspect-[16/9] rounded-lg grid place-items-center text-slate-400 text-sm">
                  No image
                </div>
              )}
            <h2 class="text-lg font-semibold">{g.data.title}</h2>
            {g.data.short && (
              <p class="text-sm text-slate-600 mt-1 line-clamp-2">
                {g.data.short}
              </p>
            )}
            {g.data.tesla?.available
              ? <p class="mt-2 text-xs text-emerald-700">Available in Tesla Arcade</p>
              : <p class="mt-2 text-xs text-slate-500">Home only</p>}
          </a>
        </li>
      ))}
    </ul>
  </body>
</html>
